<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="iOS高级工程师"><title>（非越狱版）iOS微信聊天加密插件 （一） | 王孟发</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">（非越狱版）iOS微信聊天加密插件 （一）</h1><a id="logo" href="/.">王孟发</a><p class="description">跟着梦想去飞翔~   https://github.com/wmf00032</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about.html"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">（非越狱版）iOS微信聊天加密插件 （一）</h1><div class="post-meta">Sep 6, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/09/06/wechat-secret/" href="/2016/09/06/wechat-secret/#comments" class="ds-thread-count"></a><a data-disqus-identifier="2016/09/06/wechat-secret/" href="/2016/09/06/wechat-secret/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-微信砸壳"><span class="toc-number">2.</span> <span class="toc-text">2. 微信砸壳</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#class-dump-提取头文件"><span class="toc-number">3.</span> <span class="toc-text">class-dump 提取头文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cycript调试"><span class="toc-number">4.</span> <span class="toc-text">cycript调试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#第一步获取所有的联系人信息"><span class="toc-number">4.1.</span> <span class="toc-text">第一步获取所有的联系人信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IDA分析汇编代码"><span class="toc-number">5.</span> <span class="toc-text">IDA分析汇编代码</span></a></li></ol></div></div><div class="post-content"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>之前见过别人做过微信自动抢红包插件，感觉挺酷，自己也看了一堆关于iOS应用逆向和安全的书，打算自己也做个小玩意出来，希望以此激发自己不断探索和学习的激情。</p>
<p>做个什么好尼？别人已经做过的 再去做就没有意思啦，打算做一个别人都没有尝试过的玩意。那就做个微信聊天加密插件吧！产生这样的需求的原因： 每次见到女朋友第一时间就是交上手机，然后微信、QQ聊天记录让她一个一个的查看，真的好烦，不给手机还不行，不给手机她就给你哭爹喊娘要死要活，说你做贼心虚。好吧！有的时候有些聊天信息来不及删除，万一被看见那就大祸临头了。如果能过对指定的聊天人信息进行加密，而又不引起她（他）的察觉该多好！</p>
<p>哈哈，宅男、浪女们是不是有点小激动。先给大家视频演示一下效果<strong>（Youtube视频，观看需翻墙）</strong>，然后给大家慢慢解释实现原理：</p>
<p>无法播放请点击该地址：<br><a href="http://www.le.com/ptv/vplay/26482914.html" target="_blank" rel="external">http://www.le.com/ptv/vplay/26482914.html</a></p>
<embed bgcolor="0x000000" src="http://player.56.com/v_MTQxNzgyODk1.swf" type="application/x-shockwave-flash" width="560" height="315">

<iframe bgcolor="0x000000" width="560" height="315" src="https://www.youtube.com/embed/1LpJ-zd5XLE" frameborder="0" allowfullscreen></iframe>


<p>我们的产品要求：</p>
<blockquote>
<pre><code>1. 获取微信所有联系人
2. 建立联系人“加密列表”
3. 可以添加和删除指定的联系人到“加密列表”，操作时必须输入设置的密码
4. 第一次使用用户有 “设置密码”按钮引导设置密码
5. 已经设置密码的用户“设置密码”按钮变为“修改密码”按钮
6. 已经在“加密列表”的联系人聊天界面显示全部是密文
7. 在密文聊天界面长按聊天消息弹出解密提示，只有输正确了密码当前界面才会更新显示明文，在非解密的状态下聊天录音不予播放。
</code></pre></blockquote>
<p>先大概说一下思路，我们需要通过逆向工程获取<code>WeChat</code>里面的所有头文件，通过<code>Cycript</code>调试<code>WeChat</code>去获取去定位里面的方法和界面布局等，还需要使用IEA去获取具体指定头文件方法的具体实现，这部分实现代码都是汇编代码。</p>
<h1 id="2-微信砸壳"><a href="#2-微信砸壳" class="headerlink" title="2. 微信砸壳"></a>2. 微信砸壳</h1><p>首先这个过程你需要一台越狱手机，然后通过数据线连接你的手机，当然你也可以使用SSH远程连接你的手机（速度很慢，所以我不喜欢），前提是必须在同一个局域网。下面我说说如何通过数据线连接越狱手机调试<code>WeChat</code>。</p>
<p>从<code>AppStore</code>上面下载的<code>app</code>需要砸壳，不然无法获取到里面的头文件，<br>打开mac终端</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">映射端口：./tcprelay<span class="selector-class">.py</span> -t <span class="number">22</span>:<span class="number">2222</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%87.png?raw=true" alt=""></p>
<p>再按command+t打开一个新的终端</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">通过端口链接：ssh root@localhost -<span class="selector-tag">p</span> <span class="number">2222</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%872.png?raw=true" alt=""></p>
<p>这个时候就已经连接到手机了，可以进行<code>cycript</code>调试指定的进程。</p>
<p>手机打开微信，运行着的app才能称之为进程，输入一下命令：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iPhone:~ root# ps -e | <span class="keyword">grep</span> WeChat</div><div class="line"><span class="number">23768</span> ??         <span class="number">1</span>:<span class="number">18.84</span> <span class="regexp">/var/m</span>obile<span class="regexp">/Containers/</span>Bundle<span class="regexp">/Application/</span><span class="number">1</span>D35C333-<span class="number">4</span>F71-<span class="number">4</span>DBB-<span class="number">89</span>F7-<span class="number">8348</span>A3130FD0<span class="regexp">/WeChat.app/</span>WeChat</div></pre></td></tr></table></figure>
<p>然后附着在WeChat进程</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">-iPhone:~ root<span class="comment"># cycript -p 23768</span></div><div class="line">cy<span class="comment"># UIApp.keyWindow.recursiveDescription().toString()</span></div><div class="line">`<span class="variable">&lt;iConsoleWindow: 0x17d23ac0; baseClass = UIWindow; frame = (0 0; 320 568); autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x17d22b70&gt;</span>; layer = <span class="variable">&lt;UIWindowLayer: 0x17d237c0&gt;</span>&gt;</div><div class="line">   |<span class="string"> &lt;UILayoutContainerView: 0x19297b30; frame = (0 0; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x193a3650&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string"> &lt;UITransitionView: 0x17f69b10; frame = (0 0; 320 568); clipsToBounds = YES; autoresize = W+H; layer = &lt;CALayer: 0x191b8d00&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIViewControllerWrapperView: 0x191eee60; frame = (0 0; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x19142080&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UILayoutContainerView: 0x17d178c0; frame = (0 0; 320 568); autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x1924fad0&gt;; layer = &lt;CALayer: 0x19272270&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UINavigationTransitionView: 0x19231e20; frame = (0 0; 320 568); clipsToBounds = YES; autoresize = W+H; layer = &lt;CALayer: 0x192053b0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIViewControllerWrapperView: 0x191a8d20; frame = (0 0; 320 568); layer = &lt;CALayer: 0x17f9f850&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMUIHookView: 0x190a9670; frame = (0 0; 320 519); layer = &lt;CALayer: 0x19399010&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMMainTableView: 0x18c55000; baseClass = UITableView; frame = (0 0; 320 568); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x17f4b330&gt;; layer = &lt;CALayer: 0x17f4b2c0&gt;; contentOffset: &#123;0, -64&#125;; contentSize: &#123;320, 499&#125;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIView: 0x1924ad70; frame = (0 -64; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x19287470&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIView: 0x19287510; frame = (0 0; 320 64); alpha = nan; tag = 251658531; layer = &lt;CALayer: 0x19287580&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UITableViewWrapperView: 0x19161d20; frame = (0 0; 320 504); gestureRecognizers = &lt;NSArray: 0x191a33f0&gt;; layer = &lt;CALayer: 0x191a3350&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;320, 504&#125;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;NewMainFrameCell: 0x1941a5f0; baseClass = UITableViewCell; frame = (0 304; 320 65); autoresize = W; gestureRecognizers = &lt;NSArray: 0x1941b2c0&gt;; layer = &lt;CALayer: 0x1941a570&gt;&gt;</span></div></pre></td></tr></table></figure>
<p>23768是<code>WeChat</code>进程序，当然你也可以直接输入以下命令直接附着<code>WeChat</code></p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-<span class="ruby"><span class="symbol">iPhone:</span>~ root<span class="comment"># cycript -p WeChat</span></span></div><div class="line">cy#</div></pre></td></tr></table></figure>
<p>这个就省去了寻找进程号的步骤了。<br><code>UIApp.keyWindow.recursiveDescription().toString()</code></p>
<p>命令是递归打印当前界面的所有控件<br>关于<code>cycript</code>的使用请看文档：<br><a href="http://www.cycript.org/" target="_blank" rel="external">http://www.cycript.org/</a></p>
<p>当然关于<code>cycript</code>的调试我们在后面会专门来细讲，这里我们主要是要获取到<code>WeChat</code>的沙盒路径，输入一下命令：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cy<span class="meta"># [[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory</span></div><div class="line"><span class="symbol">                                              inDomains:</span>NSUserDomainMask][<span class="number">0</span>]</div><div class="line"><span class="meta">#<span class="string">"file:///var/mobile/Containers/Data/Application/DE952C97-6274-4F97-BC0D-B3D9D522FD9C/Documents/"</span></span></div></pre></td></tr></table></figure>
<p>手机上<code>/var/mobile/Containers/Data/Application/DE952C97-6274-4F97-BC0D-B3D9D522FD9C/Documents/</code> 就是<code>WeChat</code>的沙盒路径</p>
<p>将<code>dumpdecrypted.dylib</code> 拷贝到<code>WeChat</code>的<code>Documents</code>的目录下面<br>拷贝有两种方式：</p>
<blockquote>
<ol>
<li>使用scp命令</li>
<li>使用PP助手直接找到WeChat的Documents目录进行拷贝</li>
</ol>
</blockquote>
<p>我们来到<code>Documents</code> 目录看一下</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-<span class="ruby"><span class="symbol">iPhone:</span>~ root<span class="comment"># cd /var/mobile/Containers/Data/Application/DE952C97-6274-4F97-BC0D-B3D9D522FD9C/Documents/</span></span></div><div class="line">-<span class="ruby"><span class="symbol">iPhone:</span>/var/mobile/Containers/Data/Application/DE952C97-<span class="number">6274</span>-<span class="number">4</span>F97-BC0D-B3D9D522FD9C/Documents root<span class="comment"># ls</span></span></div><div class="line">00000000000000000000000000000000/  SafeMode.dat</div><div class="line">CrashReport/                       b783b480395e7407834d7ca23f062501/</div><div class="line">Ksid                               dumpdecrypted.dylib</div><div class="line">LocalInfo.lst                      encription.fo</div><div class="line">MMResourceMgr/                     mmupdateinfo.archive</div><div class="line">MMappedKV/</div></pre></td></tr></table></figure>
<p><code>dumpdecrypted.dylib</code>动态库已经拷贝到了改目录。然后使用<code>dumpdecrypted.dylib</code>进行砸壳，命令：<code>DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib</code> 可执行二进制文件<br>如下：</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">-iPhone:/var/mobile/Containers/Data/Application/DE952C97-<span class="number">6274</span>-<span class="number">4</span>F97-BC0D-B3D9D522FD9C/Documents root# DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/mobile/Containers/Bundle/Application/<span class="number">1</span>D35C333-<span class="number">4</span>F71-<span class="number">4</span>DBB-<span class="number">89</span>F7-<span class="number">8348</span>A3130FD0/WeChat.app/WeChat</div><div class="line">mach-o decryption dumper</div><div class="line"></div><div class="line">DISCLAIMER: This tool <span class="keyword">is</span> only meant <span class="keyword">for</span> security research purposes, <span class="keyword">not</span> <span class="keyword">for</span> application crackers.</div><div class="line"></div><div class="line">[+] detected <span class="number">32</span><span class="built_in">bit</span> ARM binary <span class="keyword">in</span> memory.</div><div class="line">[+] offset <span class="keyword">to</span> cryptid found: @<span class="number">0</span>x7ca4c(from <span class="number">0</span>x7c000) = a4c</div><div class="line">[+] Found encrypted data at address <span class="number">00004000</span> <span class="keyword">of</span> length <span class="number">40910848</span> bytes - <span class="keyword">type</span> <span class="number">1</span>.</div><div class="line">[+] Opening /private/var/mobile/Containers/Bundle/Application/<span class="number">1</span>D35C333-<span class="number">4</span>F71-<span class="number">4</span>DBB-<span class="number">89</span>F7-<span class="number">8348</span>A3130FD0/WeChat.app/WeChat <span class="keyword">for</span> reading.</div><div class="line">[+] Reading header</div><div class="line">[+] Detecting header <span class="keyword">type</span></div><div class="line">[+] Executable <span class="keyword">is</span> a FAT image - searching <span class="keyword">for</span> right <span class="keyword">architecture</span></div><div class="line">[+] Correct arch <span class="keyword">is</span> at offset <span class="number">16384</span> <span class="keyword">in</span> the <span class="keyword">file</span></div><div class="line">[+] Opening WeChat.decrypted <span class="keyword">for</span> writing.</div><div class="line">[+] Copying the <span class="keyword">not</span> encrypted start <span class="keyword">of</span> the <span class="keyword">file</span></div><div class="line">[+] Dumping the decrypted data into the <span class="keyword">file</span></div><div class="line">[+] Copying the <span class="keyword">not</span> encrypted remainder <span class="keyword">of</span> the <span class="keyword">file</span></div><div class="line">[+] Setting the LC_ENCRYPTION_INFO-&gt;cryptid <span class="keyword">to</span> <span class="number">0</span> at offset <span class="number">4</span>a4c</div><div class="line">[+] Closing original <span class="keyword">file</span></div><div class="line">[+] Closing dump <span class="keyword">file</span></div></pre></td></tr></table></figure>
<p>如上输出标示砸壳成功，提别提示！<code>WeChat.app</code>目录和 <code>Documents</code> 目录并不是同一个目录，看清楚了，上面出现的两个目录是不一样的。我们再看一下Documents 目录下面文件结构，输入命令如下：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">9D522FD9C/Documents root<span class="comment"># ls -l</span></div><div class="line">total 100020</div><div class="line">drwxr-xr-x <span class="number"> 6 </span>mobile mobile      <span class="number"> 272 </span>Sep <span class="number"> 3 </span>10:44 00000000000000000000000000000000/</div><div class="line">drwxr-xr-x <span class="number"> 3 </span>mobile mobile      <span class="number"> 136 </span>Sep <span class="number"> 3 </span>17:38 CrashReport/</div><div class="line">-rw-r--r-- <span class="number"> 1 </span>mobile mobile      <span class="number"> 286 </span>Sep <span class="number"> 3 </span>10:46 Ksid</div><div class="line">-rw-r--r-- <span class="number"> 1 </span>mobile mobile     <span class="number"> 1097 </span>Sep <span class="number"> 3 </span>23:03 LocalInfo.lst</div><div class="line">drwxr-xr-x <span class="number"> 5 </span>mobile mobile      <span class="number"> 272 </span>Sep <span class="number"> 3 </span>23:03 MMResourceMgr/</div><div class="line">drwxr-xr-x <span class="number"> 2 </span>mobile mobile      <span class="number"> 680 </span>Sep <span class="number"> 3 </span>10:45 MMappedKV/</div><div class="line">-rw-r--r-- <span class="number"> 1 </span>mobile mobile       <span class="number"> 15 </span>Sep <span class="number"> 3 </span>23:40 SafeMode.dat</div><div class="line">-rw-r--r-- <span class="number"> 1 </span>root   mobile<span class="number"> 102197168 </span>Sep <span class="number"> 3 </span>23:36 WeChat.decrypted</div><div class="line">drwxr-xr-x<span class="number"> 22 </span>mobile mobile     <span class="number"> 1258 </span>Sep <span class="number"> 3 </span>23:40 b783b480395e7407834d7ca23f062501/</div><div class="line">-rw-r--r-- <span class="number"> 1 </span>root   mobile   <span class="number"> 197528 </span>Sep <span class="number"> 3 </span>23:32 dumpdecrypted.dylib</div><div class="line">-rw-r--r-- <span class="number"> 1 </span>mobile mobile      <span class="number"> 358 </span>Sep <span class="number"> 3 </span>17:38 encription.fo</div><div class="line">-rw-r--r-- <span class="number"> 1 </span>mobile mobile      <span class="number"> 448 </span>Sep <span class="number"> 3 </span>12:24 mmupdateinfo.archive</div></pre></td></tr></table></figure>
<p>多了一个文件<code>WeChat.decrypted</code>，它就是我们砸壳解密后的<code>WeChat</code>二进制文件。将该文件<code>copy</code>到mac上面，我们要提取它里面的所有<code>.h</code> 头文件。</p>
<h1 id="class-dump-提取头文件"><a href="#class-dump-提取头文件" class="headerlink" title="class-dump 提取头文件"></a>class-dump 提取头文件</h1><p>使用<code>class-dump</code>提取砸壳后的头文件</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">wangmengfa:~ Mango$ class-dump --help</div><div class="line">class-dump 3.5 (64 bit)</div><div class="line">Usage: class-dump [options] &lt;mach-o-file&gt;</div><div class="line"></div><div class="line">  where options are:</div><div class="line">        -<span class="ruby">a             show instance variable offsets</span></div><div class="line">        -<span class="ruby">A             show implementation addresses</span></div><div class="line">        -<span class="ruby">-arch &lt;arch&gt;  choose a specific architecture from a universal binary (ppc, ppc64, i386, x86_64, armv6, armv7, armv7s, arm64)</span></div><div class="line">        -<span class="ruby">C &lt;regex&gt;     only display classes matching regular expression</span></div><div class="line">        -<span class="ruby">f &lt;str&gt;       find string <span class="keyword">in</span> method name</span></div><div class="line">        -<span class="ruby">H             generate header files <span class="keyword">in</span> current directory, <span class="keyword">or</span> directory specified with -o</span></div><div class="line">        -<span class="ruby">I             sort classes, categories, <span class="keyword">and</span> protocols by inheritance (overrides -s)</span></div><div class="line">        -<span class="ruby">o &lt;dir&gt;       output directory used <span class="keyword">for</span> -H</span></div><div class="line">        -<span class="ruby">r             recursively expand frameworks <span class="keyword">and</span> fixed VM shared libraries</span></div><div class="line">        -<span class="ruby">s             sort classes <span class="keyword">and</span> categories by name</span></div><div class="line">        -<span class="ruby">S             sort methods by name</span></div><div class="line">        -<span class="ruby">t             suppress header <span class="keyword">in</span> output, <span class="keyword">for</span> testing</span></div><div class="line">        -<span class="ruby">-list-arches  list the arches <span class="keyword">in</span> the file, <span class="keyword">then</span> exit</span></div><div class="line">        -<span class="ruby">-sdk-ios      specify iOS SDK version (will look <span class="keyword">in</span> /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS&lt;version&gt;.sdk</span></div><div class="line">        -<span class="ruby">-sdk-mac      specify Mac OS X version (will look <span class="keyword">in</span> /Developer/SDKs/MacOSX&lt;version&gt;.sdk</span></div><div class="line">        -<span class="ruby">-sdk-root     specify the full SDK root path (<span class="keyword">or</span> use --sdk-ios/--sdk-mac <span class="keyword">for</span> a shortcut)</span></div></pre></td></tr></table></figure>
<p>终端输入<code>class-dump</code>列出了它的用法，使用<code>-H</code> 输入头文件，<code>-o</code> 是指定输出目录，<code>--arch &lt;arch&gt;</code>指定处理器架构。</p>
<p>开始操作，输入：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wangmengfa:~ Mango$ <span class="keyword">class</span>-<span class="keyword">dump</span> -H <span class="regexp">/Users/</span>wangmengfa<span class="regexp">/Desktop/</span>WeChat.decrypted -o <span class="regexp">/Users/</span>wangmengfa<span class="regexp">/Desktop/my</span>WeChatHeaders</div></pre></td></tr></table></figure>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%873.png?raw=true" alt=""></p>
<p>输入如上命令，只在<code>myWeChatHeaders</code> 文件见下生成了一个<code>CDStructures.h</code>头文件，其它头文件尼？很显然，操作失败了。正确的操作应该是使用class-dump的–arch <arch>指定 WeChat的处理器架构。</arch></p>
<p>先看一下<code>WeChat</code>支持的处理器架构，这里使用的是 <code>otool</code>命令：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">wangmengfa:~ Mango$ otool -hV /Users/wangmengfa/Desktop/WeChat<span class="selector-class">.decrypted</span></div><div class="line">/Users/wangmengfa/Desktop/WeChat<span class="selector-class">.decrypted</span> (architecture armv7):</div><div class="line">Mach <span class="selector-tag">header</span></div><div class="line">      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags</div><div class="line">   MH_MAGIC     ARM         V7  <span class="number">0</span>x00     EXECUTE    <span class="number">75</span>       <span class="number">7288</span>   NOUNDEFS DYLDLINK TWOLEVEL WEAK_DEFINES BINDS_TO_WEAK PIE</div><div class="line">/Users/wangmengfa/Desktop/WeChat<span class="selector-class">.decrypted</span> (architecture arm64):</div><div class="line">Mach <span class="selector-tag">header</span></div><div class="line">      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags</div><div class="line">MH_MAGIC_64   ARM64        ALL  <span class="number">0</span>x00     EXECUTE    <span class="number">75</span>       <span class="number">8040</span>   NOUNDEFS DYLDLINK TWOLEVEL WEAK_DEFINES BINDS_TO_WEAK PIE</div></pre></td></tr></table></figure>
<p>好了，看的很清楚了，<code>WeChat</code> 这里支持 <code>armv7</code>、<code>arm64</code>两种架构。</p>
<p>再次使用<code>class-dump</code>命令导出头文件如下：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wangmengfa:~ Mango$ <span class="keyword">class</span>-<span class="keyword">dump</span> --arch armv7 -H <span class="regexp">/Users/</span>wangmengfa<span class="regexp">/Desktop/</span>WeChat.decrypted -o <span class="regexp">/Users/</span>wangmengfa<span class="regexp">/Desktop/my</span>WeChatHeaders</div></pre></td></tr></table></figure>
<p>输出了一大坨文件:</p>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%874.png?raw=true" alt=""></p>
<p>接下来最好的就是讲这坨头文件导入到一个<code>Xcode</code>测试项目中去，方便查看与查找，很可惜这坨头文件实在太大啦，每次往<code>Xcode</code>项目中导入的时候都会把<code>Xcode</code>干崩溃。还是乖乖的在文件中查找吧。</p>
<h1 id="cycript调试"><a href="#cycript调试" class="headerlink" title="cycript调试"></a>cycript调试</h1><h2 id="第一步获取所有的联系人信息"><a href="#第一步获取所有的联系人信息" class="headerlink" title="第一步获取所有的联系人信息"></a>第一步获取所有的联系人信息</h2><p>开始分析：<br>我们知道在微信的“通讯录”界面会显示当前用户的所有联系人，那么我们猜想：肯定在“通讯录”界面的代码中能够找到获取所有联系人的方法。</p>
<p>我们通过操作“通讯录”<code>Tab</code>发现，并不是每次点击这个<code>tab</code>都会请求网络，即使是<code>kill</code>应用重启，点击“通讯录”<code>Tab</code>也会闪电般的显示数据而没有任何请求网络的意思。很显然数据是在第一次请求网络获取联系人数据之后就保存到本地了，然后每次启动只要发现本地有联系人数据就从本地加载。</p>
<p>如果是你，开发这个“通讯录”<code>tab</code>你会在<code>Controller</code>启动的时候时机加载本地数据尼？<br>是的，很有可能是<code>- (void)viewDidLoad</code> 方法中。</p>
<p>首先，我们需要找到“通讯录”<code>tab</code> 的控制是哪个！</p>
<p>接下来进行<code>cycript</code>调试，寻找界面元素和数据，通过以下命令链接手机</p>
<blockquote>
<p>映射端口：./tcprelay.py -t 22:2222</p>
<p>通过端口链接：ssh root@localhost -p 2222</p>
</blockquote>
<p>附着在<code>WeChat</code>上面</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wangmengfa:python-client Mango$ ssh root<span class="meta">@localhost</span> -p 2222</div><div class="line">root<span class="meta">@localhost's</span> password: </div><div class="line">wutde-iPhone:~ root<span class="comment"># cycript -p WeChat</span></div><div class="line">cy<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>然后通过<code>UIApp.keyWindow.recursiveDescription().toString()</code>命令打印当前界面所有元素。</p>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%875.png?raw=true" width="320" height="568" alt="图片名称" align="center"></p>
<p>打印如下：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="variable">&lt;iConsoleWindow: 0x156f59a0; baseClass = UIWindow; frame = (0 0; 320 568); autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x156f6ab0&gt;</span>; layer = <span class="variable">&lt;UIWindowLayer: 0x156f5de0&gt;</span>&gt;</div><div class="line">   |<span class="string"> &lt;UILayoutContainerView: 0x16a214d0; frame = (0 0; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x16a21470&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string"> &lt;UITransitionView: 0x16a21d20; frame = (0 0; 320 568); clipsToBounds = YES; autoresize = W+H; layer = &lt;CALayer: 0x16a21f10&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIViewControllerWrapperView: 0x16b1fdc0; frame = (0 0; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x16aba1f0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UILayoutContainerView: 0x16a0ca90; frame = (0 0; 320 568); autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x16a10870&gt;; layer = &lt;CALayer: 0x16a0cb10&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UINavigationTransitionView: 0x16a0dd30; frame = (0 0; 320 568); clipsToBounds = YES; autoresize = W+H; layer = &lt;CALayer: 0x16a0ddc0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIViewControllerWrapperView: 0x169fa770; frame = (0 0; 320 568); layer = &lt;CALayer: 0x169fa7e0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMUIHookView: 0x16c66080; frame = (0 0; 320 568); layer = &lt;CALayer: 0x169f8770&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMMainTableView: 0x164e3000; baseClass = UITableView; frame = (0 0; 320 568); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x169321e0&gt;; layer = &lt;CALayer: 0x156f7ca0&gt;; contentOffset: &#123;0, -64&#125;; contentSize: &#123;320, 6859&#125;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIView: 0x16c59cf0; frame = (0 -64; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x169d2610&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UITableViewWrapperView: 0x169be700; frame = (0 0; 320 568); gestureRecognizers = &lt;NSArray: 0x16c4c6d0&gt;; layer = &lt;CALayer: 0x16c48630&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;320, 568&#125;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;NewContactsItemCell: 0x16a02c50; baseClass = UITableViewCell; frame = (0 495; 320 55); autoresize = W; gestureRecognizers = &lt;NSArray: 0x16af5f10&gt;; layer = &lt;CALayer: 0x16a02b50&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UITableViewCellContentView: 0x16a02f40; frame = (0 0; 320 55); gestureRecognizers = &lt;NSArray: 0x16a03140&gt;; layer = &lt;CALayer: 0x16a02fb0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIView: 0x16a03b50; frame = (0 0; 320 55); layer = &lt;CALayer: 0x16af5db0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;ContactsItemView: 0x16890680; frame = (0 0; 320 55); layer = &lt;CALayer: 0x16890740&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMHeadImageView: 0x16af9870; frame = (10 9.5; 36 36); layer = &lt;CALayer: 0x16890860&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMUILongPressImageView: 0x16890770; baseClass = UIImageView; frame = (0 0; 36 36); opaque = NO; layer = &lt;CALayer: 0x16890800&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIButton: 0x16af9950; frame = (0 0; 36 36); hidden = YES; opaque = NO; layer = &lt;CALayer: 0x16af9a50&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIImageView: 0x16ab8440; frame = (0 0; 36 36); clipsToBounds = YES; opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x16ab84c0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMCPLabel: 0x16af7200; baseClass = UILabel; frame = (56 5.5; 112 44); text = 'A-\u8303\u513f\ud83d\udc8b\ud83d\udc8b\ud83d\udc8b'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16af7100&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;_UILabelContentLayer: 0x16b15930&gt; (layer)</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;_UITableViewCellSeparatorView: 0x16af7dd0; frame = (10 54.5; 310 0.5); layer = &lt;CALayer: 0x16af7e50&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;NewContactsItemCell: 0x16af8100; baseClass = UITableViewCell; frame = (0 440; 320 55); autoresize = W; gestureRecognizers = &lt;NSArray: 0x16ab20b0&gt;; layer = &lt;CALayer: 0x16b64610&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UITableViewCellContentView: 0x168531c0; frame = (0 0; 320 55); gestureRecognizers = &lt;NSArray: 0x16837eb0&gt;; layer = &lt;CALayer: 0x16853230&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIView: 0x16ad6980; frame = (0 0; 320 55); layer = &lt;CALayer: 0x16ad69f0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;ContactsItemView: 0x16b415e0; frame = (0 0; 320 55); layer = &lt;CALayer: 0x16b416a0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMHeadImageView: 0x16a003f0; frame = (10 9.5; 36 36); layer = &lt;CALayer: 0x16b416d0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMUILongPressImageView: 0x1688bd70; baseClass = UIImageView; frame = (0 0; 36 36); opaque = NO; layer = &lt;CALayer: 0x16a004d0&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIButton: 0x16b1a280; frame = (0 0; 36 36); hidden = YES; opaque = NO; layer = &lt;CALayer: 0x16a00500&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;UIImageView: 0x16af6670; frame = (0 0; 36 36); clipsToBounds = YES; opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x16af6740&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;MMCPLabel: 0x16af82d0; baseClass = UILabel; frame = (56 5.5; 62 44); text = 'AA_\u6b23\u6b23'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16b4bd40&gt;&gt;</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;_UILabelContentLayer: 0x16c495c0&gt; (layer)</span></div><div class="line">   |<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string">    </span>|<span class="string"> &lt;_UITableViewCellSeparatorView: 0x16a008a0; frame = (10 54.5; 310 0.5); layer = &lt;CALayer: 0x16a00920&gt;&gt;</span></div></pre></td></tr></table></figure>
<p>输出了一堆界面元素和相关信息，信息很多我这而只粘出部分数据，当前界面的层级结构已经很清楚了，<code>NewContactsItemCell</code> 就是用来显示当前联系人的<code>cell</code> ，<code>MMMainTableView</code>就是当前界面的<code>tableview</code>。但是这里显示的都是View信息，并没有直接显示<code>controller</code> , 接下来我们要<code>view</code>信息寻找到当前界面<code>controller</code>。</p>
<p>我们看见<code>MMMainTableView</code>的信息是这样的</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">MMMainTableView:</span> <span class="attr">0x164e3000</span>; <span class="attr">baseClass</span> = <span class="string">UITableView;</span> <span class="attr">frame</span> = <span class="string">(0</span> <span class="attr">0</span>; <span class="attr">320</span> <span class="attr">568</span>); <span class="attr">clipsToBounds</span> = <span class="string">YES;</span> <span class="attr">gestureRecognizers</span> = &lt;<span class="attr">NSArray:</span> <span class="attr">0x169321e0</span>&gt;</span>; layer = <span class="tag">&lt;<span class="name">CALayer:</span> <span class="attr">0x156f7ca0</span>&gt;</span>; contentOffset: </span><span class="template-variable">&#123;0, -64&#125;</span><span class="xml">; contentSize: </span><span class="template-variable">&#123;320, 6859&#125;</span><span class="xml">&gt;</span></div></pre></td></tr></table></figure>
<p>其中<code>0x164e3000</code>表示的是<code>MMMainTableView</code>内存地址，我们可以通过0x164e3000操作<code>MMMainTableView</code>对象。<br>输入一下命令：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cy<span class="meta"># [#0x164e3000 nextResponder]</span></div><div class="line"><span class="meta">#<span class="string">"&lt;MMUIHookView: 0x16c66080; frame = (0 0; 320 568); layer = &lt;CALayer: 0x169f8770&gt;&gt;"</span></span></div><div class="line">cy<span class="meta"># [#0x16c66080 nextResponder]</span></div><div class="line"><span class="meta">#<span class="string">"&lt;ContactsViewController: 0x15bb3a00&gt;"</span></span></div></pre></td></tr></table></figure>
<p>好了，通过<code>nextResponder</code>寻找下一个事件响应者，我们找到了当前界面的<code>controller</code>就是 <code>ContactsViewController</code></p>
<h1 id="IDA分析汇编代码"><a href="#IDA分析汇编代码" class="headerlink" title="IDA分析汇编代码"></a>IDA分析汇编代码</h1><p>接下来我们要分析一下<code>ContactsViewController</code> 是如何加载所有的联系人数据的。<br>将砸壳后的<code>WeChat.decrypted</code>二进制文件用<code>IDA</code>打开，将会反编译出所有的文件的汇编代码。我们找到<code>ContactsViewController</code> 的<code>viewDidLoad</code>方法。看到汇编代码如下：</p>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%876.png?raw=true" alt=""></p>
<p>非常明确了，在<code>ContactsViewController</code> 的viewDidLoad方法中做了几件很简单的事情：</p>
<blockquote>
<pre><code>1. 第一步是调用父类的viewDidLoad方法
2. 第二步是调用了 initData方法
3. 第三步是调用了initView方法
4. 第四步是调用了[MMServiceCenter defaultCenter] 方法然后通过getService方法获取到了有个服务
</code></pre></blockquote>
<p>是的，用屁股想都能猜到，<code>initData</code>方法是用来初始化界面显示数据的。那么很有可能就是在这里面获取获取到当前界面所有联系人数据的。</p>
<p>同理查看<code>initData</code>汇编代码：</p>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%877.png?raw=true" alt=""></p>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%878.png?raw=true" alt=""></p>
<p>从代码的执行来看，<code>initData</code>会先判断 <code>m_contactsDataLogic</code> 成员变量是否为空，如果是空，则说明什么也不执行，如果不是空，就会执行创建 <code>m_contactsDataLogic</code>变量的工作。 <code>m_contactsDataLogic</code>变量是干嘛的尼？以至于初始化数据方法基本是围绕创建它的，从字面理解Logic是“逻辑学”的意思， <code>m_contactsDataLogic</code>大概意思就是“联系人数据逻辑操作”，是的联系人操作的工具类。从<code>m_contactsDataLogic</code>的创建方法来看它的类型是 <code>ContactsDataLogic</code>。我们在头文件中找到<code>ContactsDataLogic</code>类。</p>
<p><img src="https://github.com/wmf00032/imagesRecource/blob/master/WeChatImage/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%879.png?raw=true" alt=""></p>
<p>里面有两个方法很诱惑人：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="name">id</span>)getAllContacts<span class="comment">;</span></div><div class="line">- (<span class="name">id</span>)getAllContactsDictionary<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>还是那句话，用屁股想都能想到是干嘛的。除了获取所有联系人方法，里面还有其它对联系人操作的方法比如增加、删除、查找、修改等，我这儿只截出了一部分。<br>下面我们要验证一下上面获取所有联系人得方法是不是真的能够获取到所有联系人。</p>
<p>链接手机输入<code>cycript</code> 命令如下：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cy<span class="meta"># [#0x16c66080 nextResponder]</span></div><div class="line"><span class="meta">#<span class="string">"&lt;ContactsViewController: 0x15bb3a00&gt;"</span></span></div><div class="line">cy<span class="meta"># var contactLogic = [#0x15bb3a00 valueForKey:@<span class="string">"m_contactsDataLogic"</span>]</span></div><div class="line"><span class="meta">#<span class="string">"&lt;ContactsDataLogic: 0x169d0960&gt;"</span></span></div></pre></td></tr></table></figure>
<pre><code>获取到了`ContactsViewController` 的 `m_contactsDataLogic`属性，然后我们调用`getAllContacts`方法看能不能打印出所有的联系人
</code></pre><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">cy# [#0x169d0960 getAllContacts]</div><div class="line">@[#"&#123;m_nsUsrName=wxi*c21~19, m_nsEncodeUserName=v1_b32e1ed63dee45756bf04c925bac2b3384e42addbd76ebfab3e4b31ee514f64e54e736a0a35f3787bd9f94dd1ff8865c@stranger, alias=kao*eld~8, m_nsNickName=<span class="symbol">\x</span>e9<span class="symbol">\x</span>ab<span class="symbol">\x</span>98<span class="symbol">\x</span>e9<span class="symbol">\x</span>a3<span class="symbol">\x</span>9e, m_uiType=3, m_uiConType=0, m_nsRemark=,  m_nsCountry=CN m_nsProvince=Beijing m_nsCity=Chaoyang m_nsSignature=<span class="symbol">\x</span>e5<span class="symbol">\x</span>8c<span class="symbol">\x</span>85<span class="symbol">\x</span>e5<span class="symbol">\x</span>ae<span class="symbol">\x</span>b9<span class="symbol">\x</span>e4<span class="symbol">\x</span>b8<span class="symbol">\x</span>8d<span class="symbol">\x</span>e8<span class="symbol">\x</span>83<span class="symbol">\x</span>bd<span class="symbol">\x</span>e6<span class="symbol">\x</span>94<span class="symbol">\x</span>b9<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>98<span class="symbol">\x</span>e7<span class="symbol">\x</span>9a<span class="symbol">\x</span>84<span class="symbol">\x</span>ef<span class="symbol">\x</span>bc<span class="symbol">\x</span>8c<span class="symbol">\x</span>e5<span class="symbol">\x</span>8a<span class="symbol">\x</span>aa<span class="symbol">\x</span>e5<span class="symbol">\x</span>8a<span class="symbol">\x</span>9b<span class="symbol">\x</span>e6<span class="symbol">\x</span>94<span class="symbol">\x</span>b9<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>98<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>af<span class="symbol">\x</span>e4<span class="symbol">\x</span>bb<span class="symbol">\x</span>a5<span class="symbol">\x</span>e6<span class="symbol">\x</span>94<span class="symbol">\x</span>b9<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>98<span class="symbol">\x</span>e7<span class="symbol">\x</span>9a<span class="symbol">\x</span>84<span class="symbol">\x</span>ef<span class="symbol">\x</span>bc<span class="symbol">\x</span>8c<span class="symbol">\x</span>e7<span class="symbol">\x</span>94<span class="symbol">\x</span>a8<span class="symbol">\x</span>e6<span class="symbol">\x</span>99<span class="symbol">\x</span>ba<span class="symbol">\x</span>e6<span class="symbol">\x</span>85<span class="symbol">\x</span>a7<span class="symbol">\x</span>e5<span class="symbol">\x</span>8c<span class="symbol">\x</span>ba<span class="symbol">\x</span>e5<span class="symbol">\x</span>88<span class="symbol">\x</span>86<span class="symbol">\x</span>e5<span class="symbol">\x</span>93<span class="symbol">\x</span>aa<span class="symbol">\x</span>e4<span class="symbol">\x</span>ba<span class="symbol">\x</span>9b<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>af<span class="symbol">\x</span>e4<span class="symbol">\x</span>bb<span class="symbol">\x</span>a5<span class="symbol">\x</span>e6<span class="symbol">\x</span>94<span class="symbol">\x</span>b9<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>98 <span class="symbol">\t</span> m_uiSex=1 m_uiCerFlag=0 m_nsCer= scene=3 &#125;",#"&#123;m_nsUsrName=wxi*222~19, m_nsEncodeUserName=v1_c78736e3a7f04cf39a750dd214e842bb2cb65276dcd231ed4e1d1002156f1488a91201e8bd653f895de2d97b0c5ac7ad@stranger, alias=, m_nsNickName=<span class="symbol">\x</span>e6<span class="symbol">\x</span>9e<span class="symbol">\x</span>9c<span class="symbol">\x</span>e5<span class="symbol">\x</span>ad<span class="symbol">\x</span>90, m_uiType=3, m_uiConType=0, m_nsRemark=<span class="symbol">\x</span>e5<span class="symbol">\x</span>93<span class="symbol">\x</span>a5<span class="symbol">\x</span>e5<span class="symbol">\x</span>93<span class="symbol">\x</span>a5,  m_nsCountry= m_nsProvince= m_nsCity= m_nsSignature= <span class="symbol">\t</span> m_uiSex=0 m_uiCerFlag=0 m_nsCer= scene=10 &#125;",#"&#123;m_nsUsrName=wxi*i22~19, m_nsEncodeUserName=v1_d50b3448e35f1cd099956a44c5e5410b81a7d937b0e246436a985dff45cb51597cbee5429e9f8f34c14c4e254bc88ab8@stranger, alias=nih*520~13, m_nsNickName=<span class="symbol">\x</span>e6<span class="symbol">\x</span>9e<span class="symbol">\x</span>9c<span class="symbol">\x</span>e5<span class="symbol">\x</span>ad<span class="symbol">\x</span>90, m_uiType=3, m_uiConType=0, m_nsRemark=<span class="symbol">\x</span>e5<span class="symbol">\x</span>93<span class="symbol">\x</span>a5<span class="symbol">\x</span>e5<span class="symbol">\x</span>93<span class="symbol">\x</span>a5,  m_nsCountry=CN</div><div class="line">```	</div><div class="line">一堆联系人信息输入出来。证明我们以上的猜想是正确的。（真实联系人敏感数据，我只截出了极少的一部分）只要我们获取到`ContactsDataLogic`对象，就可以自由的操作所有联系人数据了。</div><div class="line">	</div><div class="line">那么怎么样创建`ContactsDataLogic`对象尼？从`ContactsViewController` 的`initData`汇编代码实现来看，`ContactsDataLogic`是通过自身的方法 `initWithScene:delegate:sort:extendChatRoom:`方法创建的，下面我们来验证一下是否如此。</div><div class="line"></div><div class="line">``` </div><div class="line"></div><div class="line">cycript操作如下：</div><div class="line">cy# var myNewContactLogic = [[ContactsDataLogic alloc] initWithScene:nil delegae:nil sort:0 extendChatRoom:NO]</div><div class="line">#"&lt;ContactsDataLogic: 0x16a0bdc0&gt;"</div><div class="line">cy# [myNewContactLogic getAllContacts]</div><div class="line">@[#"&#123;m_nsUsrName=wxi*c21~19, m_nsEncodeUserName=v1_b32e1ed63dee45756bf04c925bac2b3384e42addbd76ebfab3e4b31ee514f64e54e736a0a35f3787bd9f94dd1ff8865c@stranger, alias=kao*eld~8, m_nsNickName=<span class="symbol">\x</span>e9<span class="symbol">\x</span>ab<span class="symbol">\x</span>98<span class="symbol">\x</span>e9<span class="symbol">\x</span>a3<span class="symbol">\x</span>9e, m_uiType=3, m_uiConType=0, m_nsRemark=,  m_nsCountry=CN m_nsProvince=Beijing m_nsCity=Chaoyang m_nsSignature=<span class="symbol">\x</span>e5<span class="symbol">\x</span>8c<span class="symbol">\x</span>85<span class="symbol">\x</span>e5<span class="symbol">\x</span>ae<span class="symbol">\x</span>b9<span class="symbol">\x</span>e4<span class="symbol">\x</span>b8<span class="symbol">\x</span>8d<span class="symbol">\x</span>e8<span class="symbol">\x</span>83<span class="symbol">\x</span>bd<span class="symbol">\x</span>e6<span class="symbol">\x</span>94<span class="symbol">\x</span>b9<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>98<span class="symbol">\x</span>e7<span class="symbol">\x</span>9a<span class="symbol">\x</span>84<span class="symbol">\x</span>ef<span class="symbol">\x</span>bc<span class="symbol">\x</span>8c<span class="symbol">\x</span>e5<span class="symbol">\x</span>8a<span class="symbol">\x</span>aa<span class="symbol">\x</span>e5<span class="symbol">\x</span>8a<span class="symbol">\x</span>9b<span class="symbol">\x</span>e6<span class="symbol">\x</span>94<span class="symbol">\x</span>b9<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>98<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>af<span class="symbol">\x</span>e4<span class="symbol">\x</span>bb<span class="symbol">\x</span>a5<span class="symbol">\x</span>e6<span class="symbol">\x</span>94<span class="symbol">\x</span>b9<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>98<span class="symbol">\x</span>e7<span class="symbol">\x</span>9a<span class="symbol">\x</span>84<span class="symbol">\x</span>ef<span class="symbol">\x</span>bc<span class="symbol">\x</span>8c<span class="symbol">\x</span>e7<span class="symbol">\x</span>94<span class="symbol">\x</span>a8<span class="symbol">\x</span>e6<span class="symbol">\x</span>99<span class="symbol">\x</span>ba<span class="symbol">\x</span>e6<span class="symbol">\x</span>85<span class="symbol">\x</span>a7<span class="symbol">\x</span>e5<span class="symbol">\x</span>8c<span class="symbol">\x</span>ba<span class="symbol">\x</span>e5<span class="symbol">\x</span>88<span class="symbol">\x</span>86<span class="symbol">\x</span>e5<span class="symbol">\x</span>93<span class="symbol">\x</span>aa<span class="symbol">\x</span>e4<span class="symbol">\x</span>ba<span class="symbol">\x</span>9b<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>af<span class="symbol">\x</span>e4<span class="symbol">\x</span>bb<span class="symbol">\x</span>a5<span class="symbol">\x</span>e6<span class="symbol">\x</span>94<span class="symbol">\x</span>b9<span class="symbol">\x</span>e5<span class="symbol">\x</span>8f<span class="symbol">\x</span>98 <span class="symbol">\t</span> m_uiSex=1 m_uiCerFlag=0 m_nsCer= scene=3 &#125;",#"&#123;m_nsUsrName=wxi*222~19, m_nsEncodeUserName=v1_c78736e3a7f04cf39a750dd214e842bb2cb65276dcd231ed4e1d1002156f1488a91201e8bd653f895de2d97b0c5ac7ad@stranger, alias=, m_nsNickName=<span class="symbol">\x</span>e6<span class="symbol">\x</span>9e<span class="symbol">\x</span>9c<span class="symbol">\x</span>e5<span class="symbol">\x</span>ad<span class="symbol">\x</span>90, m_uiType=3, m_uiConType=0, m_nsRemark=<span class="symbol">\x</span>e5<span class="symbol">\x</span>93<span class="symbol">\x</span>a5<span class="symbol">\x</span>e5<span class="symbol">\x</span>93<span class="symbol">\x</span>a5,  m_nsCountry= m_nsProvince= m_nsCity= m_nsSignature= <span class="symbol">\t</span> m_uiSex=0 m_uiCerFlag=0 m_nsCer= scene=10 &#125;",</div></pre></td></tr></table></figure>
<p>是的，可以获取到正确的联系人数据。再一次证明我们的推断是正确的。我们查看ContactsDataLogic 头文件发现：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (<span class="keyword">id</span>)initWithScene:(<span class="keyword">unsigned</span> <span class="keyword">long</span>)arg1 delegate:(<span class="keyword">id</span>)arg2;</div><div class="line">- (<span class="keyword">id</span>)initWithScene:(<span class="keyword">unsigned</span> <span class="keyword">long</span>)arg1 delegate:(<span class="keyword">id</span>)arg2 sort:(<span class="built_in">BOOL</span>)arg3 extendChatRoom:(<span class="built_in">BOOL</span>)arg4;</div><div class="line">- (<span class="keyword">id</span>)initWithScene:(<span class="keyword">unsigned</span> <span class="keyword">long</span>)arg1 delegate:(<span class="keyword">id</span>)arg2 sort:(<span class="built_in">BOOL</span>)arg3;</div></pre></td></tr></table></figure>
<p>这里面有三个<code>initWithScene</code>方法，其实我们只要使用参数最少那个就可以创建<code>ContactsDataLogic</code> 对象。</p>
<p><strong>郑重声明：未经本人允许严禁任何个人或组织转载！</strong></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/09/06/wechat-secret/" data-id="cit137ado0008heagmz63pwse" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/09/06/wechat-secret-2/" class="pre">（非越狱版）iOS微信聊天加密插件 （二）</a><a href="/2016/07/12/afnetworking-know-what/" class="next">AFNetWorking 深度理解</a></div><div data-thread-key="2016/09/06/wechat-secret/" data-title="（非越狱版）iOS微信聊天加密插件 （一）" data-url="http://yoursite.com/2016/09/06/wechat-secret/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/09/06/wechat-secret/" data-title="（非越狱版）iOS微信聊天加密插件 （一）" data-url="http://yoursite.com/2016/09/06/wechat-secret/" data-author-key="1" class="ds-thread"></div><div id="disqus_thread"><script>var disqus_shortname = 'wmf00032-github-io';
var disqus_identifier = '2016/09/06/wechat-secret/';
var disqus_title = '（非越狱版）iOS微信聊天加密插件 （一）';
var disqus_url = 'http://yoursite.com/2016/09/06/wechat-secret/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//wmf00032-github-io.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://yoursite.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/runtimeClassLoad/">iOS 运行时类的加载深入解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/dylib1/">mac和iPhone命令生成可执行文件的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/wechat-secret-4/">（非越狱版）iOS微信聊天加密插件 （四）终结篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/wechat-secret-3/">（非越狱版）iOS微信聊天加密插件 （三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/wechat-secret-2/">（非越狱版）iOS微信聊天加密插件 （二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/wechat-secret/">（非越狱版）iOS微信聊天加密插件 （一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/12/afnetworking-know-what/">AFNetWorking 深度理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/09/my-new-wmf/">iOS 基于AVPLayer封装视频播放器</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//wmf00032-github-io.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">王孟发.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'wmf00032'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>